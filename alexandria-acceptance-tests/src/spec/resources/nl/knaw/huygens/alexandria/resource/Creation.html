<html xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://huygens.knaw.nl/concordion-acceptance-test"
      xmlns:xsi="http://www.w3.org/1999/xhtml"
      xsi:schemaLocation="http://huygens.knaw.nl/concordion-acceptance-test
                          http://huygensing.github.io/alexandria/xsd/concordion-rest.xsd">

<title>Creating External Resources</title>

<body>

<div class="container">
    <div class="jumbotron">
        <h1>Creating external resources</h1>

        <p>How to register external resources to Alexandria via POST or PUT</p>
    </div>

    <div class="row">
        <div class="col-md-3">
            <ul class="nav nav-pills nav-stacked">
                <li class="active"><a href="#create-post" data-toggle="tab">Creating a resource via POST</a></li>
                <li><a href="#create-put" data-toggle="tab">Creating a resource via PUT</a></li>
                <li><a href="#post-empty" data-toggle="tab">POSTing empty body</a></li>
                <li><a href="#post-missing-ref" data-toggle="tab">POSTing a body with no 'ref' field</a></li>
                <li><a href="#put-entity-id-must-match-url" data-toggle="tab">Entity id must match id in URL</a></li>
            </ul>
        </div>

        <div class="col-md-9">
            <div class="tab-content">
                <div class="tab-pane fade in active" id="create-post">
                    <div class="panel-heading"><b>How can I create an external resource without specifying an ID?</b>
                    </div>
                    <div class="panel-body">
                        <h:request>
                            When I
                            <h:post>/resources</h:post>
                            the following body:
                            <h:jsonBody>{
                                "resource": {
                                "ref": "http://www.example.com/titles/path/to/title/resource"
                                } }
                            </h:jsonBody>
                            then I should receive:
                            <ul>
                                <li>status
                                    <h:status>201 Created</h:status>
                                </li>
                                <li> a Location header starting with
                                    <h:location type="base">https://{host}/resources/</h:location>
                                    and ending in a
                                    <h:location type="uuid">well-formed UUID</h:location>
                                </li>
                                <li>an
                                    <h:responseBody/>
                                    response body
                                </li>
                            </ul>
                        </h:request>
                    </div>
                </div>
                <div class="tab-pane fade" id="create-put" c:execute="clearStorage()">
                    <div class="panel-heading"><b>How can I create an external resource with a specific UUID?</b></div>
                    <div class="panel-body">
                        <h:request>
                            When I
                            <h:put>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:put>
                            the following body:
                            <h:jsonBody> {
                                "resource": {
                                "id": "6e56c868-c0a9-11e4-a762-cb9a664afc01",
                                "ref": "http://www.example.com/titles/path/to/title/resource",
                                "provenance": {
                                "who": "nederlab",
                                "why": "some reason",
                                "when": "2015-04-07T09:10:55.877Z"
                                } } }
                            </h:jsonBody>
                            then I should receive
                            <h:status>201 Created</h:status>
                            and the response body is
                            <h:responseBody/>
                            .
                        </h:request>
                    </div>
                </div>
                <div class="tab-pane fade" id="post-empty" c:execute="clearStorage()">
                    <div class="panel-heading"><b>What happens when I POST an empty body when creating a new
                        resource?</b>
                    </div>
                    <div class="panel-body">
                        <h:request>
                            When I
                            <h:post>/resources</h:post>
                            the following body:
                            <pre class="json" c:execute="body(#TEXT)"> </pre>
                            then I should receive
                            <h:status>400 Bad Request</h:status>
                            and the response body contains:
                            <h:jsonResponse>[{"message":"may not be null"}]</h:jsonResponse>
                        </h:request>
                    </div>
                </div>
                <div class="tab-pane fade" id="post-missing-ref" c:execute="clearStorage()">
                    <div class="panel-heading">
                        <b>What happens when I POST a body without a <code>ref</code> when creating a new resource?</b>
                    </div>
                    <div class="panel-body">
                        <h:request>
                            When I
                            <h:post>/resources</h:post>
                            the following body:
                            <h:jsonBody>{
                                "resource": {
                                "provenance" : {
                                "who" : "nederlab",
                                "why" : "some reason",
                                "when" : "2015-04-07T09:10:55.877Z"
                                } } }
                            </h:jsonBody>
                            Then I should receive
                            <h:status>400 Bad Request</h:status>
                            and the response body contains:
                            <h:jsonResponse>[{"message":"Missing required 'ref' field"}]</h:jsonResponse>
                        </h:request>
                    </div>
                </div>
                <div class="tab-pane fade" id="put-entity-id-must-match-url" c:execute="clearStorage()">
                    <div class="panel-heading">
                        <b>When creating a new resource via PUT, the id in the entity body MUST match the one used in
                            the
                            URL</b>
                    </div>
                    <div class="panel-body">
                        <h:request>
                            When I
                            <h:put>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:put>
                            the following body (note the mismatch for parameter <code>id</code>):
                            <h:jsonBody>{
                                "resource": {
                                "id": "3c86e050-f7d8-11e4-9c82-df9a2acb2bd1",
                                "ref": "http://www.example.com/titles/path/to/title/resource"
                                } }
                            </h:jsonBody>
                            Then I should receive
                            <h:status>400 Bad Request</h:status>
                            and the response body contains:
                            <h:jsonResponse>[{"message" : "Entity 'id' must match the one used in the URL"}]
                            </h:jsonResponse>
                        </h:request>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>

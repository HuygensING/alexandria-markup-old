<html xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://alexandria.huygens.knaw.nl/concordion-extension"
      xmlns:xsi="http://www.w3.org/1999/xhtml"
      xsi:schemaLocation="http://alexandria.huygens.knaw.nl/concordion-extension
                          http://huygensing.github.io/alexandria/xsd/concordion-rest.xsd">

<title>Querying External Resources</title>

<body class="container">

    <h2 class="page-header">Querying external resources</h2>

    <h3>Examples:</h3>

    <div id="get-non-existent" class="panel panel-default" c:execute="clearStorage()">
        <div class="panel-heading"><b>What happens when I GET a non-existent resource?</b></div>
        <div class="panel-body">
            Given that no resource exists with ID <code>3ed4faaa-c0cd-11e4-a84e-83ef41cbdc44</code>
            <h:request>
                When I <h:get>/resources/3ed4faaa-c0cd-11e4-a84e-83ef41cbdc44</h:get>
                then I should receive <h:status>404 Not Found</h:status>
                and the response body should contain:
                <h:jsonResponse>{
                    "error": {
                        "message": "No resource found with id 3ed4faaa-c0cd-11e4-a84e-83ef41cbdc44"
                    }
                }</h:jsonResponse>
            </h:request>
        </div>
    </div>

    <div id="get-all-resource-data" class="panel panel-default" c:execute="clearStorage()">
        <div class="panel-heading"><b>How can I get all data for a given resource?</b></div>
        <div class="panel-body">
            <h:request>
                Given I have <h:success>successfully</h:success>
                <h:put>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:put> the following body:
                <h:jsonBody>{
                    "resource": {
                        "id": "6e56c868-c0a9-11e4-a762-cb9a664afc01",
                        "ref": "http://www.example.com/titles/path/to/title/resource"
                    }
                }</h:jsonBody>
            </h:request>

            <h:request>
                When I <h:get>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:get>
                I should receive <h:status>200 OK</h:status> with a response body containing
                <h:jsonResponse>{
                    "resource": {
                        "id" : "6e56c868-c0a9-11e4-a762-cb9a664afc01",
                        "ref": "http://www.example.com/titles/path/to/title/resource",
                        "^provenance": "https://{host}/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01/provenance"
                    }
                }</h:jsonResponse>
            </h:request>

            <h:request>
                And <h:get>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01/provenance</h:get>
                should return <h:status>200 OK</h:status> with a response body containing
                <h:jsonResponse>{
                    "provenance": {
                        "who": "nederlab",
                        "why": "",
                        "when": "{date.beforeNow}",
                        "^what": "https://{host}/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01"
                    }
                } </h:jsonResponse>
            </h:request>
        </div>
    </div>

    <div id="get-resource-ref" class="panel panel-default" c:execute="clearStorage()">
        <div class="panel-heading"><b>How can I GET the <code>ref</code> of an existing resource?</b></div>
        <div class="panel-body">
            <div class="alert alert-info well-sm" role="alert">
                <strong>Question:</strong>
                Is this (still) necessary from a Nederlab point of view, or is a regular GET which yields
                <code>ref</code> as one of the many items also OK?
            </div>

            <h:request>
                Given I have <h:success>successfully</h:success>
                <h:put>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:put> the following body:
                <h:jsonBody>{
                    "resource": {
                        "id": "6e56c868-c0a9-11e4-a762-cb9a664afc01",
                        "ref": "http://www.example.com/titles/path/to/title/resource"
                    }
                }</h:jsonBody>
            </h:request>
            <h:request>
                When I <h:get>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01/ref</h:get>
                I should receive <h:status>200 OK</h:status> with a response body containing
                <h:jsonResponse>{
                    "ref": "http://www.example.com/titles/path/to/title/resource"
                }</h:jsonResponse>
            </h:request>
        </div>
    </div>

    <div id="get-resource-annotations" class="panel panel-default" c:execute="clearStorage()">
        <div class="panel-heading"><b>How can I GET the <code>annotations</code> of an existing resource?</b></div>
        <div class="panel-body">
            <div class="alert alert-warning well-sm" role="alert">
                <strong>Warning:</strong>
                This is currently a dressed-down example showing only an empty annotations array.
                It needs to use real annotations to show that you get <code>^annotation</code> results.
            </div>
            <h:request>
                Given I have <h:success>successfully</h:success>
                <h:put>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01</h:put> the following body:
                <h:jsonBody>{
                    "resource": {
                    "id": "6e56c868-c0a9-11e4-a762-cb9a664afc01",
                    "ref": "http://www.example.com/titles/path/to/title/resource"
                    }
                    }</h:jsonBody>
            </h:request>
            <h:request>
                When I <h:get>/resources/6e56c868-c0a9-11e4-a762-cb9a664afc01/annotations</h:get>
                I should receive <h:status>200 OK</h:status> with a response body containing
                <h:jsonResponse>{
                    "annotations": []
                }</h:jsonResponse>
            </h:request>
        </div>
    </div>
    <!--

    <div c:execute="clear()" class="example">
        <h3>How can I GET the annotations of an existing resource?</h3>

        <ul>
            <li c:execute="existingResource(#id)">Given an existing resource
                <ul>
                    <li>identified by <code c:set="#id">c6b96360-c0c9-11e4-b947-6bc57448d166</code>;</li>
                    <li c:execute="withReference(#ref)">referring to
                        <code c:set="#ref">http://www.example.com/titles/path/to/title/resource</code>;
                    </li>
                    <li c:execute="withAnnotation(#annoId)">with an annotation identified by
                        <code c:set="#annoId">92af4396-cc77-11e4-9b9b-1f1561a91434</code>;
                    </li>
                    <li c:execute="withAnnotation(#annoId)">and an annotation identified by
                        <code c:set="#annoId">42f22020-cc82-11e4-aec9-1be06e873083</code>.
                    </li>
                </ul>
            </li>
            <li>When I <b c:set="#method">GET</b> <code><b
                    c:set="#endpoint">/resources/c6b96360-c0c9-11e4-b947-6bc57448d166/annotations</b></code></li>

            <li c:execute="request(#method, #endpoint)">Then:
                <ol>
                    <li>the response status should be <b c:assertEquals="status()">200 OK</b>;</li>
                    <li>And the response body looks like:
<pre json:includesJson="response()">{
    "annotations": [{
        "annotation": {
            "id": "92af4396-cc77-11e4-9b9b-1f1561a91434"
        },
        "annotation": {
            "id": "42f22020-cc82-11e4-aec9-1be06e873083"
        }
    }]
}</pre>
                    </li>
                </ol>
            </li>
        </ul>
    </div>
</div>
-->
</body>
</html>
